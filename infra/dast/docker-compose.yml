services:
  zap:
    image: ghcr.io/zaproxy/zaproxy:stable
    container_name: owasp-zap
    user: zap
    volumes:
      # レポート出力先
      - ./reports:/zap/reports:rw
      # ZAP設定ファイル
      - ./zap-baseline-config.yaml:/zap/config.yaml:ro
      # カスタムスクリプト（オプション）
      - ./scripts:/zap/scripts:ro
    networks:
      - dast-network
    command: >
      zap-baseline.py
      -t ${TARGET_URL:-http://bookmark-manager-staging-alb-491287683.ap-northeast-1.elb.amazonaws.com/samples}
      -r /zap/reports/zap-report-$(date +%Y%m%d-%H%M%S).html
      -J /zap/reports/zap-report-$(date +%Y%m%d-%H%M%S).json
      -w /zap/reports/zap-report-$(date +%Y%m%d-%H%M%S).md
      -x /zap/reports/zap-report-$(date +%Y%m%d-%H%M%S).xml
      -l INFO
      -c /zap/config.yaml
      -a
    environment:
      # タイムゾーン設定
      - TZ=Asia/Tokyo
      # ZAPのメモリ設定
      - ZAPROXY_JAVA_OPTS=-Xmx2g

networks:
  dast-network:
    driver: bridge
